"use strict";if(!Settings.get("vimSync")&&("[]"===localStorage.getItem("exclusionRules")&&Backend.onInit||Settings.updateHooks.exclusionRules))var Exclusions=null;else{var Exclusions;(Exclusions=!Exclusions||Exclusions instanceof Promise?{testers:null,getRe:function(e){var t=this.testers[e],s;if(t)return t;t="^"===e[0]&&(s=Utils.makeRegexp(e,"",false))?s.test.bind(s):this._startsWith.bind(e.substring(1));return this.testers[e]=t},_startsWith:function(e){return e.startsWith(this)},_listening:false,_listeningHash:false,onlyFirstMatch:false,rules:[],setRules:function(e){var t;if(0!==e.length){this.testers||(this.testers=Object.create(null));this.rules=this.format(e);this.onlyFirstMatch=Settings.get("exclusionOnlyFirstMatch");this.testers=null;Backend.getExcluded=this.GetPattern;if(!this._listening){this._listening=true;if(t=this.getOnURLChange()){chrome.webNavigation.onHistoryStateUpdated.addListener(t);if(Settings.get("exclusionListenHash")&&!this._listeningHash){this._listeningHash=true;chrome.webNavigation.onReferenceFragmentUpdated.addListener(t)}}}}else{this.rules=[];Backend.getExcluded=Utils.getNull;if(this._listening&&(t=this.getOnURLChange())){chrome.webNavigation.onHistoryStateUpdated.removeListener(t);if(this._listeningHash){this._listeningHash=false;chrome.webNavigation.onReferenceFragmentUpdated.removeListener(t)}}this._listening=false}},GetPattern:function(e){for(var t=Exclusions.rules,s="",n=0,i=t.length;n<i;n+=2)if(t[n](e)){var a=t[n+1];if(0===a.length||Exclusions.onlyFirstMatch)return a;s+=a}return s||null},getOnURLChange:function(){var e=chrome.webNavigation?41<=Settings.CONST.ChromeVersion?Backend.checkIfEnabled:function(e){for(var t=Backend.indexPorts(e.tabId),s={name:"url",handler:"checkIfEnabled"},n=t?t.length:0;0<--n;)t[n].postMessage(s)}:null;this.getOnURLChange=function(){return e};return e},format:function(e){for(var t=[],s=0,n=e.length;s<n;s++){var i=e[s];t.push(this.getRe(i.pattern),i.passKeys)}return t},getTemp:function(e,t){var s=this.rules;this.rules=this.format(t);var n=this.GetPattern(e);this.rules=s;return n},RefreshStatus:function(e){var t=0<Exclusions.rules.length?null:{name:"reset",passKeys:null};if(e)t||Settings.broadcast({name:"url",handler:"checkIfEnabled"});else{var s=Backend.indexPorts(),n=!!(Backend.IconBuffer&&(Backend.IconBuffer()||Settings.get("showActionIcon"))),i=null,a=0;for(var r in s){for(var l=s[r],o=l[0].sender.status,u=l.length;0<--u;){var c=l[u];if(t){if(0===c.sender.status)continue}else{a=null===(i=Backend.getExcluded(c.sender.url))?0:i?1:2;if(!i&&c.sender.status===a)continue}if(!(1&c.sender.flags)){c.postMessage(t||{name:"reset",passKeys:i});c.sender.status=a}}n&&o!==(a=l[0].sender.status)&&Backend.setIcon(0|r,a)}}},destroy:function(){Settings.updateHooks.exclusionRules=Settings.updateHooks.exclusionOnlyFirstMatch=Settings.updateHooks.exclusionListenHash=void 0}}:Exclusions).setRules(Settings.get("exclusionRules"));Settings.updateHooks.exclusionRules=function(t){setTimeout(function(){var e=Exclusions.rules.length<=0;Exclusions.setRules(t);setTimeout(Exclusions.RefreshStatus,17,e)},17)};Settings.updateHooks.exclusionOnlyFirstMatch=function(e){Exclusions.onlyFirstMatch=e};Settings.updateHooks.exclusionListenHash=function(e){var t=Exclusions;if(t._listening){var s=t.getOnURLChange();if(s){t._listeningHash=e;var n=chrome.webNavigation.onReferenceFragmentUpdated;e?n.addListener(s):n.removeListener(s)}}}}