"use strict";if("object"==typeof VSettings&&VSettings&&"function"==typeof VSettings.destroy){VSettings.destroy(true,true);window.dispatchEvent(new Event("unload"))}var Vomnibar={pageType:0,activate:function(t){Object.setPrototypeOf(t,null);this.mode.type=this.modeType=(t.mode||"")+""||"omni";this.forceNewTab=!!t.force;this.baseHttps=null;var e=t.url,i=t.keyword,s=t.search,n,r=window.devicePixelRatio;this.zoomLevel=r<.98?1/r:1;this.setWidth(.8*t.width+24);var o=Math.max(3,Math.min(0|(t.height-159)/44,this.maxResults));this.maxHeight=Math.ceil(44*(this.mode.maxResults=o)+76);this.init&&this.setPType(t.ptype);this.mode.favIcon&&(this.favPrefix='" style="background-image: url(&quot;chrome://favicon/size/16'+(1<(r=r<1.5?1:r<3?2:r<4?3:4)?"@"+r+"x":"")+"/");if(null==e)return this.reset(i?i+" ":"");if(s){n=s.start;e=s.url;i||(i=s.keyword)}else if(null===s){e=VUtils.decodeURL(e).replace(/\s$/g,"%20");if(!i&&/^https?:\/\//i.test(e)){this.baseHttps=115==(32|e.charCodeAt(4));e=e.substring(this.baseHttps?8:7,e.indexOf("/",8)===e.length-1?e.length-1:void 0)}}else e=VUtils.decodeURL(e,decodeURIComponent).trim().replace(this._spacesRe," ");return i?this.reset(i+" "+e,n=(n||0)+i.length+1,n+e.length):this.reset(e)},isActive:false,inputText:"",lastQuery:"",lastNormalInput:"",modeType:"omni",useInput:true,completions:null,total:0,maxPageNum:Math.min(Math.max(3,0|window.VomnibarMaxPageNum||10),100),isEditing:false,isInputComposing:false,baseHttps:null,isHttps:null,isSearchOnTop:false,actionType:0,matchType:0,focused:true,showing:false,firstShowing:true,focusByCode:true,blurWanted:false,forceNewTab:false,sameOrigin:false,showFavIcon:0,showRelevancy:false,zoomLevel:1,lastScrolling:0,height:0,maxHeight:0,input:null,bodySt:null,barCls:null,isSelOriginal:true,lastKey:0,keyResult:0,list:null,onUpdate:null,doEnter:null,refreshInterval:Math.max(256,0|window.VomnibarRefreshInterval||500),wheelInterval:Math.max(33,0|window.VomnibarWheelInterval||100),renderItems:null,selection:-1,atimer:0,timer:0,wheelTime:0,browserVersion:999,wheelOptions:{passive:false,capture:true},show:function(){this.showing=true;this.bodySt.zoom=1!==this.zoomLevel?this.zoomLevel+"":"";this.firstShowing?setTimeout(Vomnibar.focus,34):this.firstShowing=false;addEventListener("wheel",this.onWheel,this.wheelOptions);this.OnShown&&setTimeout(this.OnShown,100)},hide:function(t){this.isActive=this.showing=this.isEditing=this.isInputComposing=this.blurWanted=this.focusByCode=false;removeEventListener("wheel",this.onWheel,this.wheelOptions);0<this.timer&&clearTimeout(this.timer);window.onkeyup=null;var e=this.input;e.blur();t||VPort.postMessage({handler:"nextFrame",type:2,key:this.lastKey});this.bodySt.cssText="display: none;";this.list.textContent=e.value="";this.list.style.height="";this.barCls.remove("empty");this.list.classList.remove("no-favicon");if(this.sameOrigin)return this.onHidden();this.atimer=requestAnimationFrame(this.AfterHide);this.timer=setTimeout(this.AfterHide,35)},AfterHide:function(){var t=Vomnibar;cancelAnimationFrame(t.atimer);clearTimeout(t.timer);t.height&&t.onHidden()},onHidden:function(){VPort.postToOwner({name:"hide"});this.timer=this.height=this.matchType=this.wheelTime=this.actionType=this.total=this.lastKey=0;this.zoomLevel=1;this.completions=this.onUpdate=this.isHttps=this.baseHttps=null;this.mode.query=this.lastQuery=this.inputText=this.lastNormalInput="";this.isSearchOnTop=false;this.modeType=this.mode.type="omni";this.doEnter?setTimeout(this.doEnter,0):/a?/.test("");this.doEnter=null},reset:function(t,e,i){this.inputText=t;this.useInput=false;this.isHttps=this.baseHttps;this.mode.query=this.lastQuery=t&&t.trim().replace(this._spacesRe," ");this.height=0;this.isActive=true;this.update(0,e<=i?function(){this.input.value===this.inputText&&this.input.setSelectionRange(e,i)}:null);this.init&&this.init();this.input.value=this.inputText},focus:function(t){var e=Vomnibar;e.focusByCode=true;false!==t?e.input.focus():VPort.postMessage({handler:"nextFrame",type:2,key:e.lastKey})},update:function(t,e){this.onUpdate=e||null;if(0<=t){this.isInputComposing=false;0<this.timer&&clearTimeout(this.timer);if(0===t)return this.fetch()}else{if(0<this.timer)return;t=this.refreshInterval}this.timer=setTimeout(this.OnTimer,t)},doRefresh:function(t){var e=this.selection,i=this.isSelOriginal;this.useInput=false;this.setWidth();return this.update(t,function(){var t=this.completions.length;if(!i&&0<=e&&0<t){e=Math.min(e,t-1);this.selection=0;this.isSelOriginal=false;this.updateSelection(e)}this.focused||this.focus()})},updateInput:function(t){var e=this.focused,i=this.blurWanted;this.isSelOriginal=false;if(-1!==t){i&&e&&this.input.blur();var s=this.completions[t];if(s.parsed)return this._updateInput(s,s.parsed);null==s.https&&(s.https=s.url.startsWith("https://"));if("history"===s.type||"tab"===s.type){var n=!s.text,r=s.url,o=VUtils.ensureText(s),a=n?r:VUtils.decodeURL(r,decodeURIComponent);if(!n&&a.length===r.length&&0<=r.indexOf("%")){a=s.text;if(o){a.lastIndexOf("://",5)<0&&(a=(7===o?"http://":"https://")+a);!r.endsWith("/")&&a.endsWith("/")||(a+="/")}}return VPort.postMessage({handler:"parseSearchUrl",id:t,url:a})}if(null==s.parsed){VUtils.ensureText(s);s.parsed=""}this._updateInput(s,s.text);"math"===s.type&&this.input.select()}else{this.isHttps=this.baseHttps;this.isEditing=false;this.input.value=this.inputText;if(!e){this.focus();this.blurWanted=i}}},parsed:function(t){var e=t.id,i=t.search,s=this.completions[e];s.parsed=i?("omni"!==this.modeType?":o ":"")+i.keyword+" "+i.url+" ":s.text;if(e===this.selection)return this._updateInput(s,s.parsed)},toggleInput:function(){if(!(this.selection<0)){if(this.isSelOriginal){this.inputText=this.input.value;return this.updateInput(this.selection)}var t=this.completions[this.selection],e=this.input.value.trim();return this._updateInput(t,e=e===t.url?t.parsed||t.text:e===t.text?t.url:t.text)}},_updateInput:function(t,e){var i=10*e.length,s=i>innerWidth-86;this.input.value=e;s&&(this.input.scrollLeft=i);this.isHttps=t.https&&e===t.text;this.isEditing=e!==t.parsed||t.parsed===t.text},updateSelection:function(t){if(!this.timer){var e=this.list.children,i=this.selection;(this.isSelOriginal||i<0)&&(this.inputText=this.input.value);this.updateInput(t);this.selection=t;0<=i&&e[i].classList.remove("s");0<=t&&e[t].classList.add("s")}},ctrlMap:{32:9,66:10,74:8,75:6,78:8,80:6,219:1,221:9},normalMap:{9:8,27:1,33:10,34:11,38:6,40:8,112:4,113:5},onKeydown:function(t){if(this.isActive){var e=0,i=t.keyCode,s=this.focused;this.lastKey=i;if(t.altKey||t.metaKey){if(t.ctrlKey||t.shiftKey);else{if(113===i)return this.onAction(s?3:2);if(s){if(65<i&&i<71&&67!==i||8===i)return this.onBashAction(i-64)}else;}if(t.altKey){this.keyResult=0;return}}if(13!==i){if(t.ctrlKey||t.metaKey)if(t.shiftKey)e=70===i?11:66===i?10:0;else{if(38===i||40===i||35===i||36===i){t.preventDefault();this.lastScrolling=Date.now();window.onkeyup=Vomnibar.HandleKeydown;return VPort.postToOwner({name:"scroll",keyCode:i})}e="BracketLeft"===t.code?1:"BracketRight"===t.code?9:this.ctrlMap[i]||0}else if(t.shiftKey)e=38===i?10:40===i?11:9===i?6:46===i?13:0;else if(e=this.normalMap[i]||0);else{if(229===i||112<i&&i<132){this.keyResult=0;return}if(8===i){s&&(this.keyResult=1);return}32!==i||(s?(0<=this.selection||this.completions.length<=1)&&this.input.value.endsWith("  ")&&(e=12):e=2)}if(e)return this.onAction(e);if(!s&&i<58&&47<i){i=i-48||10;return!t.shiftKey&&i<=this.completions.length?this.onEnter(t,i-1):void 0}this.keyResult=s&&93!==i?1:0}else window.onkeyup=this.OnEnterUp}},onAction:function(t){var e;switch(t){case 1:var i;if("Range"!==window.getSelection().type||!this.focused)return this.hide();var s=this.input;s.setSelectionRange(e="backward"!==s.selectionDirection&&s.selectionEnd<s.value.length?s.selectionStart:s.selectionEnd,e);break;case 2:this.focus();break;case 3:this.blurWanted=true;this.input.blur();break;case 4:case 5:this.focused?5===t?this.focus(false):document.execCommand("delete"):this.focus();break;case 6:case 8:return this.updateSelection(e=((e=this.completions.length+1)+this.selection+(t-6))%e-1);case 9:return this.toggleInput();case 10:case 11:return this.goPage(10!==t);case 12:return this.onEnter(true);case 13:return this.removeCur()}},onBashAction:function(t){var e,i=4===t||t<0;window.getSelection().modify(i?"extend":"move",t<4?"backward":"forward","word");if(i&&this.input.selectionStart<this.input.selectionEnd)return document.execCommand("delete")},_pageNumRe:/(?:^|\s)(\+\d{0,2})$/,goPage:function(t){if(!this.isSearchOnTop){var e=this.completions.length,i=this.mode.maxResults,s=e?this.completions[0].type:"",n=+t||-1;s=(this.isSelOriginal||this.selection<0?this.input.value:this.inputText).trimRight();var r=this._pageNumRe.exec(s),o=0|(r&&r[0]);if(i<=e)n*=i;else if(0<o&&n<0)n*=i<=o?i:1;else if(e<(e&&"tab"!==this.completions[0].type?i:3))return;var a=Math.min(Math.max(0,o+n),this.maxPageNum*i-i);if(!(0<n&&(a===o||this.total<=a&&0<this.total))){r&&(s=s.substring(0,s.length-r[0].length));s=s.trimRight();o=Math.min(this.input.selectionEnd,s.length);0<a&&(s+=" +"+a);var h=this.input.selectionStart,l=this.input.selectionDirection;this.input.value=s;this.input.setSelectionRange(h,o,l);this.isInputComposing=false;return this.update(-1)}}},onEnter:function(t,e){var i=null!=e?e:this.selection;this.actionType=null==t?this.actionType:true===t?this.forceNewTab?-1:0:t.ctrlKey||t.metaKey?t.shiftKey?-2:-1:t.shiftKey||!this.forceNewTab?0:-1;if(null!=e);else{if(-1===i&&0===this.input.value.length)return;if(this.timer){if(!this.isEditing){if(0<this.timer)return this.update(0,this.onEnter);this.onUpdate=this.onEnter;return}i=-1}else;}var s=0<=i?this.completions[i]:{url:this.input.value.trim()},n=this.actionType,r=this.isHttps,o=function(){null!=s.sessionId?Vomnibar.gotoSession(s):Vomnibar.navigateToUrl(s.url,n,r);/a?/.test("")};if(this.actionType<-1)return o();this.doEnter=o;return this.hide()},OnEnterUp:function(t){if(true===t.isTrusted||null==t.isTrusted&&t instanceof KeyboardEvent&&13===t.keyCode){Vomnibar.lastKey=0;window.onkeyup=null;return Vomnibar.onEnter(t)}},removeCur:function(){if(!(this.selection<0)){var t=this.completions[this.selection],e=t.type;if("tab"===e||"history"===e&&null==t.sessionId){VPort.postMessage({handler:"removeSug",type:e,url:"tab"===e?t.sessionId+"":t.url});return this.refresh()}VPort.postToOwner({name:"hud",text:"This item can not be deleted."})}},onClick:function(t){var e=t.target;if(false!==t.isTrusted&&t instanceof MouseEvent&&e!==this.input&&"Range"!==window.getSelection().type){if(e===this.input.parentElement)return this.focus();if(this.timer)t.preventDefault();else{for(;e&&e.parentNode!==this.list;)e=e.parentNode;if(e){this.lastKey=0;return this.onEnter(t,[].indexOf.call(this.list.children,e))}}}},OnMenu:function(t){for(var e=t.target,i;e&&!e.classList.contains("url");e=e.parentElement);if(e&&!e.href){for(i=e;i&&i.parentElement!==Vomnibar.list;i=i.parentElement);var s=[].indexOf.call(Vomnibar.list.children,i);0<=s&&(e.href=Vomnibar.completions[s].url)}},OnSelect:function(){var t=this;if(0===t.selectionStart&&"backward"===t.selectionDirection){var e=t.value,i=t.selectionEnd-1;32===e.charCodeAt(i)&&i!==e.length-1&&-1===(e=e.substring(0,i).trimRight()).indexOf(" ")&&t.setSelectionRange(0,e.length,"backward")}},OnFocus:function(t){false!==t.isTrusted&&(Vomnibar.focused="blur"!==t.type)&&(Vomnibar.blurWanted=false)},OnTimer:function(){if(Vomnibar)return Vomnibar.fetch()},onWheel:function(t){if(!t.ctrlKey&&!t.metaKey&&false!==t.isTrusted){t.preventDefault();t.stopImmediatePropagation();if(!(t.deltaX||!t.deltaY||Date.now()-this.wheelTime<this.wheelInterval)&&Vomnibar.isActive){this.wheelTime=Date.now();return this.goPage(0<t.deltaY)}}},onInput:function(t){var e=this.lastQuery,i=this.input.value,s=i.trim();this.blurWanted=false;if(s!==(-1===this.selection||this.isSelOriginal?e:this.completions[this.selection].text)&&(1!==this.matchType||!s.startsWith(e))){s||(this.isHttps=this.baseHttps=null);var n=this.input.selectionStart,r;if(this.isSearchOnTop);else if(i.length-2<n){if(i.endsWith(" +")&&!this.timer&&s.substring(0,s.length-2).trimRight()===e)return}else if((r=this._pageNumRe.exec(e))&&s.endsWith(r[0])){var o=r[0].length,a=i.substring(0,i.trimRight().length-o);if(a.trim()!==e.substring(0,e.length-o).trimRight()){this.input.value=a.trimRight();this.input.setSelectionRange(n,n)}}var h=t.isComposing;if(null!=h){h&&!this.isInputComposing&&(this.lastNormalInput=this.input.value.trim());this.isInputComposing=h}return this.update(-1)}},omni:function(t){if(this.isActive){var e=t.list,i,s=0<e.length;this.total=t.total;this.showFavIcon=t.favIcon;this.matchType=t.matchType;this.completions=e;this.selection=(t.autoSelect||"omni"!==this.modeType)&&s?0:-1;this.isSelOriginal=true;this.isSearchOnTop=s&&"search"===e[0].type;return this.populateUI()}},populateUI:function(){var t=this.completions.length,e=0<t,i=this.height,s=this.list,n=this.height=Math.ceil(e?44*t+76:73),r=n!==i,o=i<n||this.sameOrigin,a={name:"style",height:n};i||(a.max=this.maxHeight);r&&o&&VPort.postToOwner(a);this.completions.forEach(this.parse,this);s.innerHTML=this.renderItems(this.completions);i||(this.bodySt.display="");var h=this.barCls,l="empty";e?h.remove(l):h.add(l);h=s.classList,l="no-favicon";this.showFavIcon?h.remove(l):h.add(l);if(e){0===this.selection&&s.firstElementChild.classList.add("s");s.lastElementChild.classList.add("b")}if(o)return this.postUpdate();requestAnimationFrame(function(){r&&VPort.postToOwner(a);return Vomnibar.postUpdate()})},postUpdate:function(){var t;this.showing||this.show();if(!(0<this.timer)){this.timer=0;this.isEditing=false;if(t=this.onUpdate){this.onUpdate=null;return t.call(this)}}},OnShown:function(){var t=Vomnibar,e=t.input;e.onselect=t.OnSelect;e.onfocus=e.onblur=t.OnFocus;t.OnShown=null;var i=addEventListener,s=Vomnibar.OnWndFocus;i("focus",s);i("blur",s);return t.blurred()},_focusTimer:0,OnWndFocus:function(t){var e=Vomnibar,i=e.focusByCode;e.focusByCode=false;if(e.isActive&&t.target===window&&false!==t.isTrusted){var s="blur"===t.type;if(s){var n=e._focusTimer;n&&clearTimeout(n);e._focusTimer=0}if(i)e.blurred(s);else if(s)VPort.postMessage({handler:"blurTest"});else{e._focusTimer=setTimeout(e.blurred,50,false);VPort&&VPort.postMessage({handler:"blank"});1===e.pageType&&VPort&&VPort.postToOwner({name:"test"})}}},blurred:function(t){var e=document.body.classList;("boolean"==typeof t?!t:document.hasFocus())?e.remove("transparent"):e.add("transparent")},init:function(){window.onclick=function(t){return Vomnibar.onClick(t)};this.onWheel=this.onWheel.bind(this);Object.setPrototypeOf(this.ctrlMap,null);Object.setPrototypeOf(this.normalMap,null);this.input=document.getElementById("input");var t=this.list=document.getElementById("list"),e=this.browserVersion;this.input.oninput=this.onInput.bind(this);this.bodySt=document.documentElement.style;this.barCls=this.input.parentElement.classList;t.oncontextmenu=this.OnMenu;document.getElementById("close").onclick=function(){return Vomnibar.hide()};addEventListener("keydown",this.HandleKeydown,true);this.renderItems=VUtils.makeListRenderer(document.getElementById("template").innerHTML);if(e<61){var i=document.createElement("style");i.textContent=".item, #input { border-width: "+(e<48?1:.01)+"px; }";document.head.appendChild(i)}if(e<56){var s=function(t){(Vomnibar.isInputComposing="compositionstart"===t.type)&&(Vomnibar.lastNormalInput=Vomnibar.input.value.trim())};this.input.addEventListener("compositionstart",s);this.input.addEventListener("compositionend",s)}this.init=VUtils.makeListRenderer=null;if(!(52<=e&&999!==e||null!=this.bodySt.d)){for(var n=document.querySelector("style").textContent,r=/\.([a-z]+)\s?\{(?:[^}]+;)?\s*d\s?:\s*path\s?\(\s?['"](.+?)['"]\s?\)/g,o=Object.create(null),a;a=r.exec(n);)o[a[1]]=a[2];this.getTypeIcon=function(t){var e=t.type,i=o[e];return i?e+'" d="'+i:e}}},getTypeIcon:function(t){return t.type},setPType:function(t){this.pageType=t;var e=0,i,s,n=58<=this.browserVersion;if(2===t||location.origin.lastIndexOf("chrome",0));else if(0===t)e=n||this.sameOrigin?2:0;else if((n||this.sameOrigin)&&(i=chrome.runtime.getManifest)&&(s=i())){var r=s.permissions||[];e=0<=r.indexOf("<all_urls>")||0<=r.indexOf("chrome://favicon/")?this.sameOrigin?2:1:0}this.mode.favIcon=e},HandleKeydown:function(t){if(true===t.isTrusted||null==t.isTrusted&&t instanceof KeyboardEvent){Vomnibar.keyResult=2;if(window.onkeyup){var e=!t.repeat,i=0;if(Vomnibar.lastScrolling){if(e||40<(i=Date.now())-Vomnibar.lastScrolling){VPort.postToOwner({name:e?"scrollEnd":"scrollGoing"});Vomnibar.lastScrolling=i}}else e=17<t.keyCode||t.keyCode<16;e&&(window.onkeyup=null)}else Vomnibar.onKeydown(t);if(0!==Vomnibar.keyResult){2===Vomnibar.keyResult&&t.preventDefault();t.stopImmediatePropagation()}}},returnFocus:function(t){setTimeout(VPort.postToOwner,0,{name:"focus",key:t.key})},_realDevRatio:0,setWidth:function(t){var e=53===this.browserVersion,i="",s,n=this.zoomLevel;if(e)if(s=this._realDevRatio){t=innerWidth/s;i=1.02<s||s<.98?Math.round(1e4/s)/100+"%":""}else{i=(t=t||parseFloat(this.bodySt.width)||innerWidth)/n+"px";this.fixRatio(t)}else;this.mode.maxChars=Math.round(((t||innerWidth)/n-86)/7.7);e&&(document.documentElement.style.width=i)},fixRatio:function(i){var s=0,n=setInterval(function(){var t=innerWidth,e=Vomnibar;if(0<t||15<s++){clearInterval(n);if(e){e._realDevRatio=t/i;0<t&&e.setWidth()}}},100)},secret:null,maxResults:0|window.VomnibarListLength||10,mode:{handler:"omni",type:"omni",maxChars:0,maxResults:0,favIcon:0,query:""},_spacesRe:/\s+/g,_singleQuoteRe:/'/g,fetch:function(){var t=this.mode,e,i,s=0;this.timer=-1;if(this.useInput){this.lastQuery=e=this.input.value.trim();this.isInputComposing&&(e=e.startsWith(i=this.lastNormalInput)?i+e.substring(i.length).replace(this._singleQuoteRe,""):e.replace(this._singleQuoteRe," "));if((e=e.replace(this._spacesRe," "))===t.query)return this.postUpdate();t.type=this.matchType<2||!e.startsWith(t.query)?this.modeType:3===this.matchType?"search":(s=this.matchType,this.completions[0].type);t.query=e;this.setWidth();this.matchType=s}else this.useInput=true;return VPort.postMessage(t)},favPrefix:"",parse:function(t){var e;t.relevancy=this.showRelevancy?'\n\t\t\t<span class="relevancy">'+t.relevancy+"</span>":"";(e=t.label)&&(t.label=' <span class="label">'+e+"</span>");t.favIcon=(e=this.showFavIcon?t.url:"")&&this.favPrefix+((e=this.parseFavIcon(t,e))?VUtils.escapeCSSStringInAttr(e):"about:blank")+"&quot;);"},parseFavIcon:function(t,e){var i=e.substring(0,11).toLowerCase();return i.startsWith("vimium://")?"chrome-extension://"+(window.ExtId||chrome.runtime.id)+"/pages/options.html":512<e.length||"javascript:"===i||i.startsWith("data:")?"":"search"===t.type?e.startsWith("http")?e.substring(0,e.indexOf("/","s"===e[4]?8:7)+1||e.length):"":e},navigateToUrl:function(t,e,i){if(58!==t.charCodeAt(10)||"javascript:"!==t.substring(0,11).toLowerCase()){VPort.postMessage({handler:"openUrl",reuse:e,https:i,url:t,omni:true});if(-2===e&&(!this.lastQuery||/^\+\d{0,2}$/.exec(this.lastQuery)))return this.refresh()}else VPort.postToOwner({name:"evalJS",url:t})},gotoSession:function(t){VPort.postMessage({handler:"gotoSession",active:-2<this.actionType,sessionId:t.sessionId});if(-2===this.actionType)return this.refresh("tab"===t.type)},refresh:function(t){window.getSelection().removeAllRanges();if(!t)return this.doRefresh(150);window.onfocus=function(t){window.onfocus=null;if(false!==t.isTrusted&&VPort.port)return Vomnibar.doRefresh(17)}},OnUnload:function(t){if(VPort&&false!==t.isTrusted){Vomnibar.isActive=false;0<Vomnibar.timer&&clearTimeout(Vomnibar.timer);VPort.postToOwner({name:"unload"})}}},VUtils={makeListRenderer:function(t){var h=t.split(/\{\{(\w+)}}/g);return function(t){for(var e="",i=h.length-1,s=0,n=t;s<n.length;s++){for(var r=n[s],o=0;o<i;o+=2){e+=h[o];var a=h[o+1];e+="typeIcon"===a?Vomnibar.getTypeIcon(r):r[a]||""}e+=h[i]}return e}},decodeURL:function(t,e){try{t=(e||decodeURI)(t)}catch(t){}return t},ensureText:function(t){var e=t.url,i=t.text,s=e.substring(0,8).toLowerCase(),n=s.startsWith("http://")?7:"https://"===s?8:0;e.length<=n&&(n=0);var r=!n;if(8===n){var o=e.indexOf("/",n);(0<o?o<e.length:/:\d+\/?$/.test(e))&&(r=true)}if(i){if(n){r&&!i.startsWith(s)&&(i=s+i);e.endsWith("/")&&!s.endsWith("/")&&0<s.indexOf("/")&&(i+="/")}}else i=!r&&n?e.substring(n):e;t.text=i;return n},escapeCSSStringInAttr:function(t){function e(t){var e=t.charCodeAt(0);return 38===e?"&amp;":39===e?"&apos;":e<39?"%22":60===e?"%3C":"%3E"}var i=/["&'<>]/g;this.escapeCSSStringInAttr=function(t){return t.replace(i,e)};return this.escapeCSSStringInAttr(t)}},VPort={port:null,postToOwner:null,postMessage:function(t){try{(this.port||this.connect(9)).postMessage(t)}catch(t){VPort=null;this.postToOwner({name:"broken",active:Vomnibar.isActive})}},Listener:function(t){return Vomnibar[t.name](t)},OnOwnerMessage:function(t){var e=t.data,i=e.name||e;return"backspace"===i?Vomnibar.onAction(4):Vomnibar[i](e)},ClearPort:function(){VPort.port=null},connect:function(t){var e={name:"vimium-c."+t},i=this.port=window.ExtId?chrome.runtime.connect(window.ExtId,e):chrome.runtime.connect(e);i.onDisconnect.addListener(this.ClearPort);i.onMessage.addListener(this.Listener);return i}};"".startsWith||(String.prototype.startsWith=function(t){return t.length<=this.length&&0===this.lastIndexOf(t,0)});"".endsWith||(String.prototype.endsWith=function(t){var e=this.length-t.length;return 0<=e&&this.indexOf(t,e)===e});window.browser&&browser.runtime&&(window.chrome=browser);(function(){if("1.68.1"==document.documentElement.getAttribute("data-version")){var t;if(location.pathname.startsWith("/front/")||"chrome-extension:"!==location.protocol||!(t=document.currentScript));else{if(!t.src.endsWith("/front/vomnibar.js")||!t.src.startsWith("chrome-extension:")){t.remove();window.onmessage=function(t){if(t.source===window.parent){var e=t.data,i=document.createElement("script"),s=i.src=e[1].script;window.ExtId=new URL(s).hostname;i.onload=function(){return window.onmessage(t)};(document.head||document.documentElement).appendChild(i)}};return}window.ExtId=new URL(t.src).hostname}var o=0,a=[],h=function(t,e,i){if(o<1||t!=o)o||a.push([t,e,i]);else{o=-1;clearTimeout(s);window.onmessage=null;Vomnibar.sameOrigin=!!e.sameOrigin;VPort.postToOwner=e.postMessage.bind(e);e.onmessage=VPort.OnOwnerMessage;window.onunload=Vomnibar.OnUnload;if(i)return Vomnibar.activate(i);e.postMessage({name:"uiComponentIsReady"})}},s=setTimeout(function(){window.location.href="about:blank"},700);Vomnibar.secret=function(t){this.secret=function(){};Vomnibar.browserVersion=t.browserVersion;var e=t.secret,i=a;o=e;a=null;for(var s=0,n=i;s<n.length;s++){var r=n[s];if(r[0]==e)return h(r[0],r[1],r[2])}};window.onmessage=function(t){if(t.source===window.parent){var e=t.data;return h(e[0],t.ports[0],e[1])}};VPort.connect(8)}else location.href="about:blank"})();